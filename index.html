<!DOCTYPE html>
<html lang="vi">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hệ Thống Kiểm Kê</title>

    <!-- CSS -->
    <link rel="stylesheet" href="styles.css">
    <link rel="icon" type="image/x-icon" href="favicon.ico">

    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">

    <!-- Firebase -->
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>
  
    <!-- Excel Library -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.16.9/xlsx.full.min.js"></script>
</head>

<body>
    <!-- Màn hình chọn vai trò -->
    <div id="roleScreen" class="login-screen">
        <div class="login-container">
            <h2>Chọn vai trò người dùng</h2>
            <button class="role-button admin-btn" data-role="admin">
                <i class="fas fa-user-shield"></i>
                Quản trị viên
            </button>
            <button class="role-button inventory-btn" data-role="inventory">
                <i class="fas fa-clipboard-list"></i>
                Kiểm kê viên
            </button>
        </div>
    </div>

    <!-- Màn hình danh mục -->
    <div id="categoryScreen" class="screen hide">
        <div class="container">
            <!-- Header -->
            <!-- Trong phần header của categoryScreen và mainScreen -->
<div class="header">
    <div class="user-profile">
        <div class="user-info" id="userInfoBtn">
            <div class="avatar">
                <i class="fas fa-user"></i>
            </div>
            <span class="user-role"></span>
            <i class="fas fa-chevron-down"></i>
        </div>

        <div class="user-menu" id="userMenu">
            <!-- Thêm toggle notification -->
            <div class="menu-item notification-toggle" id="notificationToggle">
                <i class="fas fa-bell"></i>
                <span>Nhận thông báo</span>
                <label class="switch">
                    <input type="checkbox" id="notificationCheckbox">
                    <span class="slider"></span>
                </label>
            </div>
            <div class="menu-item" onclick="backToRoleSelection()">
                <i class="fas fa-sign-out-alt"></i>
                <span>Quay lại</span>
            </div>
        </div>
    </div>
    <h2>DANH MỤC KIỂM KÊ</h2>
</div>

            <!-- Danh sách danh mục -->
            <div class="category-buttons" id="categoryButtons">
                <!-- Danh mục sẽ được tải vào đây -->
            </div>

            <!-- Điều khiển Admin -->
            <div id="categoryAdminControls" class="admin-controls hide">
                <button id="addCategoryBtn" class="btn admin-btn">
                    <i class="fas fa-plus"></i> Thêm mục kiểm kê
                </button>
                <button id="manageCategoriesBtn" class="btn action-btn">
                    <i class="fas fa-cog"></i> Quản lý mục kiểm kê
                </button>
            </div>
        </div>
    </div>

    <!-- Màn hình kiểm kê -->
    <div id="mainScreen" class="screen hide">
        <div class="container">
            <!-- Header -->
            <div class="header">

                <div class="user-profile">
                    <div class="user-info" id="screenTitleBtn">
                        <div class="avatar">
                            <i class="fas fa-clipboard-list"></i>
                        </div>
                        <span id="screenTitle" class="screen-title">KIỂM KÊ</span>
                        <i class="fas fa-chevron-down"></i>
                    </div>

                    <div class="user-menu" id="screenMenu">
                        <div class="menu-item" onclick="backToCategories()">
                            <i class="fas fa-reply"></i>
                            <span>Quay lại</span>
                        </div>
                    </div>
                </div>
            </div>

           <!-- Main Controls (Admin & Inventory) -->
<div id="mainControls" class="hide">
    <!-- Data Input Section (ADMIN ONLY) -->
     <h4 class="section-title admin-feature">
            <i class="fas fa-database"></i>
            Nhập Dữ Liệu
        </h4>
    <div class="data-input-section admin-feature">
        
        <div class="input-options">
            <!-- Option 1: Upload Excel -->
            <div class="input-option">
                <div class="option-icon excel-icon">
                    <i class="fas fa-file-excel"></i>
                </div>
                <div class="option-content">
                    <h5>Tải file Excel</h5>
                    <p>Chọn file .xlsx hoặc .xls từ máy tính</p>
                    <div class="file-input-wrapper">
                        <input type="file" id="fileInput" accept=".xlsx,.xls" onchange="validateFile(this)">
                        <label for="fileInput" class="btn btn-outline">
                            <i class="fas fa-folder-open"></i>
                            Chọn file
                        </label>
                    </div>
                    <div id="fileInfo" class="file-info hide">
                        <div class="file-details">
                            <i class="fas fa-file-excel file-icon"></i>
                            <div class="file-text">
                                <span class="file-name"></span>
                                <span class="file-size"></span>
                            </div>
                            <button onclick="clearFileSelection()" class="btn-clear-file" title="Xóa file">
                                <i class="fas fa-times"></i>
                            </button>
                        </div>
                    </div>
                    <button onclick="loadExcel()" class="btn btn-primary" id="uploadBtn" disabled>
                        <i class="fas fa-upload"></i>
                        Tải lên
                    </button>
                </div>
            </div>
            <!-- Divider -->
            <div class="option-divider">
                <span>HOẶC</span>
            </div>
            <!-- Option 2: Paste Data -->
            <div class="input-option">
                <div class="option-icon paste-icon">
                    <i class="fas fa-paste"></i>
                </div>
                <div class="option-content">
                    <h5>Paste từ Excel</h5>
                    <p>Copy dữ liệu từ Excel và paste trực tiếp</p>
                    <button onclick="showPasteDataModal()" class="btn btn-outline">
                        <i class="fas fa-clipboard"></i>
                        Mở Paste
                    </button>
                </div>
            </div>
        </div>
    </div></br>
    
    <!-- Data Management Section (MIXED ROLES) -->
     <h4 class="section-title">
        <i class="fas fa-tools"></i>
            Chức năng
            <div id="dataStats" class="data-stats hide">
                <span class="stat-badge">
                    <i class="fas fa-database"></i>
                    <strong id="totalRows">0</strong> dòng
                </span>
            </div>
        </h4>
    <div class="data-management-section">
        
        <div class="management-buttons">
            <!-- Common Buttons -->
            <button onclick="showColumnVisibilityModal()" class="btn action-btn">
                <i class="fas fa-columns"></i> Ẩn/Hiện Cột
            </button>
            <button onclick="manualSort()" class="btn action-btn">
                <i class="fas fa-sort-alpha-down"></i> Sắp xếp A-Z
            </button>
            <button onclick="saveData()" class="btn save-btn">
                <i class="fas fa-save"></i> Lưu Dữ Liệu
            </button>
            <!-- Admin Only Buttons -->
            <button onclick="exportToExcel()" class="btn btn-success admin-feature">
                <i class="fas fa-download"></i>
                Xuất Excel
            </button>
            <button onclick="clearData()" class="btn btn-danger admin-feature">
                <i class="fas fa-trash-alt"></i>
                Xóa dữ liệu
            </button>
        </div>
    </div>
<!-- Bảng dữ liệu -->
            <div class="table-container">
                <div id="tableContainer"></div>
            </div>
</div>

            
        </div>
    </div>

    <!-- Modal thêm danh mục -->
    <div id="addCategoryModal" class="modal hide">
        <div class="modal-content">
            <h3>Thêm Danh Mục Kiểm Kê Mới</h3>
            <form id="addCategoryForm">
                <div class="form-group">
                    <label for="newCategoryName">Tên danh mục:</label>
                    <input type="text" id="newCategoryName" required>
                </div>
                <div class="form-group">
                    <label for="newCategoryDesc">Mô tả:</label>
                    <textarea id="newCategoryDesc"></textarea>
                </div>
                <div class="modal-buttons">
                    <button type="submit" class="btn admin-btn">
                        <i class="fas fa-plus"></i> Thêm
                    </button>
                    <button type="button" onclick="closeModal('addCategoryModal')" class="btn cancel-btn">
                        <i class="fas fa-times"></i> Hủy
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Modal quản lý danh mục -->
    <div id="manageCategoriesModal" class="modal hide">
        <div class="modal-content">
            <h3>Quản Lý Danh Mục Kiểm Kê</h3>
            <div id="categoriesList" class="categories-list">
                <!-- Danh sách danh mục sẽ được thêm vào đây -->
            </div>
            <div class="modal-buttons">
                <button onclick="closeModal('manageCategoriesModal')" class="btn cancel-btn">
                    <i class="fas fa-times"></i> Đóng
                </button>
            </div>
        </div>
    </div>

    <div id="adminPasswordModal" class="modal hide">
    <div class="modal-content">
        <h3>Xác thực Quản trị viên</h3>
        <form id="adminPasswordForm">
            <div class="form-group">
                <label for="adminPassword">Mật khẩu:</label>
                <input type="password" id="adminPassword" required autocomplete="off">
                <small class="password-hint">Nhập mật khẩu để truy cập chức năng quản trị</small>
            </div>
            <div class="modal-buttons">
                <button type="submit" class="btn admin-btn">
                    <i class="fas fa-unlock"></i> Xác nhận
                </button>
                <button type="button" onclick="cancelAdminLogin()" class="btn cancel-btn">
                    <i class="fas fa-times"></i> Hủy
                </button>
            </div>
        </form>
    </div>
</div>

    <!-- Modal ẩn/hiện cột -->
    <div id="columnVisibilityModal" class="modal hide">
        <div class="modal-content">
            <h3>Ẩn/Hiện Cột</h3>
            <div id="columnCheckboxes">
                <!-- Checkboxes sẽ được thêm vào đây -->
            </div>
            <div class="modal-buttons">
                <button onclick="applyColumnVisibility()" class="btn admin-btn">
                    <i class="fas fa-check"></i> Áp dụng
                </button>
                <button onclick="closeModal('columnVisibilityModal')" class="btn cancel-btn">
                    <i class="fas fa-times"></i> Hủy
                </button>
            </div>
        </div>
    </div>

    <!-- Modal Paste Dữ Liệu -->
<div id="pasteDataModal" class="modal hide">
    <div class="modal-content paste-modal">
        <div class="paste-header">
            <h3>Paste Dữ Liệu từ Excel</h3>
            <button class="dialog-close" onclick="closeModal('pasteDataModal')">
                <i class="fas fa-times"></i>
            </button>
        </div>
        
        <div class="paste-instructions">
            <div class="instruction-item">
                <i class="fas fa-info-circle"></i>
                <span>Sao chép dữ liệu từ Excel (bao gồm cả tiêu đề cột)</span>
            </div>
            <div class="instruction-item">
                <i class="fas fa-mouse-pointer"></i>
                <span>Click vào ô bên dưới và nhấn <kbd>Ctrl+V</kbd> (hoặc <kbd>Cmd+V</kbd> trên Mac)</span>
            </div>
            <div class="instruction-item">
                <i class="fas fa-check-circle"></i>
                <span>Hệ thống sẽ tự động phát hiện cột và dữ liệu</span>
            </div>
        </div>

        <div class="paste-area-container">
            <textarea 
                id="pasteArea" 
                class="paste-textarea" 
                placeholder="Click vào đây và nhấn Ctrl+V để paste dữ liệu từ Excel..."
                rows="10"></textarea>
            <div class="paste-stats hide" id="pasteStats">
                <span class="stat-item">
                    <i class="fas fa-columns"></i>
                    <strong id="columnCount">0</strong> cột
                </span>
                <span class="stat-item">
                    <i class="fas fa-list"></i>
                    <strong id="rowCount">0</strong> dòng
                </span>
            </div>
        </div>

        <div id="previewContainer" class="preview-container hide">
            <h4>Xem trước dữ liệu:</h4>
            <div class="preview-table-wrapper">
                <table id="previewTable" class="preview-table">
                    <!-- Preview data will be inserted here -->
                </table>
            </div>
        </div>

        <div class="modal-buttons">
            <button onclick="processPastedData()" class="btn admin-btn" id="confirmPasteBtn" disabled>
                <i class="fas fa-check"></i> Xác nhận & Tải lên
            </button>
            <button onclick="clearPasteArea()" class="btn action-btn" id="clearPasteBtn" disabled>
                <i class="fas fa-eraser"></i> Xóa
            </button>
            <button onclick="closeModal('pasteDataModal')" class="btn cancel-btn">
                <i class="fas fa-times"></i> Hủy
            </button>
        </div>
    </div>
</div>

    <div id="dialogModal" class="dialog-modal hide">
        <div class="dialog-content">
            <div class="dialog-header">
                <h3 class="dialog-title"></h3>
                <button class="dialog-close" onclick="Dialog.close()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="dialog-body"></div>
            <div class="dialog-footer">
                <!-- Buttons will be added dynamically -->
            </div>
        </div>
    </div>

    <!-- Script -->
    <script src="script.js"></script>
</body>

</html>